CREATE TABLE USUARIOS (
    ID_USUARIO        NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USUARIO           VARCHAR2(50) UNIQUE NOT NULL,
    CLAVE             VARCHAR2(255) NOT NULL,
    NOMBRE_COMPLETO   VARCHAR2(100),
    CORREO            VARCHAR2(100),
    ROL               VARCHAR2(30) DEFAULT 'USUARIO',
    FECHA_CREACION    DATE DEFAULT SYSDATE,
    ULTIMA_SESION     DATE,
    ACTIVO            CHAR(1) DEFAULT 'S' CHECK (ACTIVO IN ('S', 'N'))
);

-- Crea la secuencia
CREATE SEQUENCE USUARIOS_SEQ
START WITH 1
INCREMENT BY 1
NOCACHE
NOCYCLE;

-- Modifica el nombre de una columna
ALTER TABLE USUARIOS RENAME COLUMN ID_USUARIO TO ID;

CREATE OR REPLACE EDITIONABLE TRIGGER USUARIOS_TRG
BEFORE INSERT ON USUARIOS 
FOR EACH ROW 
BEGIN
  IF INSERTING AND :NEW.ID IS NULL THEN
    SELECT USUARIOS_SEQ.NEXTVAL INTO :NEW.ID FROM SYS.DUAL;
  END IF;
END;
/

-- Activa la secuencia
ALTER TRIGGER USUARIOS_TRG ENABLE;

-- Verifica que esxista
SELECT trigger_name, status
FROM user_triggers
WHERE trigger_name = 'USUARIOS_TRG';
