-- Tablas tareas_proyectos

CREATE TABLE TAREAS_PROYECTOS (
    ID_TAREA              NUMBER,
    TITULO                VARCHAR2(200) NOT NULL,
    DESCRIPCION           CLOB,
    CATEGORIA             VARCHAR2(100),
    FECHA_CREACION        DATE DEFAULT SYSDATE,
    FECHA_ESTIMADA        DATE,
    FECHA_ACTUALIZACION   DATE,
    PRIORIDAD             VARCHAR2(20),  -- Ej: 'Alta', 'Media', 'Baja'
    ESTADO                VARCHAR2(50) DEFAULT 'Pendiente',  -- Ej: 'En proceso', 'Finalizada', etc.
    USUARIO_CREADOR       VARCHAR2(100) NOT NULL,
    USUARIO_ACTUALIZA     VARCHAR2(100),
    COMENTARIOS           CLOB
);

-- Crea la secuencia
CREATE SEQUENCE TAREAS_PROYECTOS_SEQ1
START WITH 1
INCREMENT BY 1
NOCACHE
NOCYCLE;

-- Modifica la secuencia
ALTER TABLE TAREAS_PROYECTOS MODIFY ID_TAREA NUMBER;

CREATE OR REPLACE EDITIONABLE TRIGGER TAREAS_PROYECTOS_TRG
BEFORE INSERT ON TAREAS_PROYECTOS 
FOR EACH ROW 
BEGIN
  IF INSERTING AND :NEW.ID_TAREA IS NULL THEN
    SELECT TAREAS_PROYECTOS_SEQ1.NEXTVAL INTO :NEW.ID_TAREA FROM SYS.DUAL;
  END IF;
END;
/

-- Activa la secuencia
ALTER TRIGGER TAREAS_PROYECTOS_TRG ENABLE;

-- Verifica que esxista
SELECT trigger_name, status
FROM user_triggers
WHERE trigger_name = 'TAREAS_PROYECTOS_TRG';
