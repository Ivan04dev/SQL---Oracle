-- Tabla tareas_proyectos

CREATE TABLE TAREAS_PROYECTOS (
    ID_TAREA              NUMBER,
    TITULO                VARCHAR2(200) NOT NULL,
    DESCRIPCION           CLOB,
    CATEGORIA             VARCHAR2(100),
    FECHA_CREACION        DATE DEFAULT SYSDATE,
    FECHA_ESTIMADA        DATE,
    FECHA_ACTUALIZACION   DATE,
    PRIORIDAD             VARCHAR2(20),  -- Ej: 'Alta', 'Media', 'Baja'
    ESTADO                VARCHAR2(50) DEFAULT 'Pendiente',  -- Ej: 'En proceso', 'Finalizada', etc.
    USUARIO_CREADOR       VARCHAR2(100) NOT NULL,
    USUARIO_ACTUALIZA     VARCHAR2(100),
    COMENTARIOS           CLOB
)SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "DATA" ;
REM INSERTING into TAREAS_PROYECTOS
SET DEFINE OFF;

-- Crea la secuencia
CREATE SEQUENCE TAREAS_PROYECTOS_SEQ1
START WITH 1
INCREMENT BY 1
NOCACHE
NOCYCLE;

-- Modifica la secuencia
ALTER TABLE TAREAS_PROYECTOS MODIFY ID NUMBER;

CREATE OR REPLACE EDITIONABLE TRIGGER PYMES_ACTIVIDADES_TRG
BEFORE INSERT ON TAREAS_PROYECTOS 
FOR EACH ROW 
BEGIN
  IF INSERTING AND :NEW.ID IS NULL THEN
    SELECT TAREAS_PROYECTOS_SEQ1.NEXTVAL INTO :NEW.ID FROM SYS.DUAL;
  END IF;
END;
/

-- Activa la secuencia
ALTER TRIGGER TAREAS_PROYECTOS_TRG ENABLE;

-- Verifica que esxista
SELECT trigger_name, status
FROM user_triggers
WHERE trigger_name = 'TAREAS_PROYECTOS_TRG';
