-- Crea la tabla
CREATE TABLE PROCESOS_CX
   (	"ID" NUMBER, 
	"FECHACREADO" TIMESTAMP (6), 
	"TITULO" VARCHAR2(200), 
	"CATEGORIA" VARCHAR2(200), 
	"DESCRIPCION" VARCHAR2(255), 
	"USUARIOCREADOR" VARCHAR2(50),
    "FECHAMODIFICA" TIMESTAMP (6), 
    "USUARIOMODIFICA"  VARCHAR2(50)
   );
   
-- Crea la secuencia
CREATE SEQUENCE PROCESOS_CX_SEQ1
START WITH 1
INCREMENT BY 1
NOCACHE
NOCYCLE;

CREATE OR REPLACE EDITIONABLE TRIGGER PROCESOS_CX_TRG
BEFORE INSERT ON PROCESOS_CX 
FOR EACH ROW 
BEGIN
  IF INSERTING AND :NEW.ID IS NULL THEN
    SELECT PROCESOS_CX_SEQ1.NEXTVAL INTO :NEW.ID FROM SYS.DUAL;
  END IF;
END;
/

-- Activa la secuencia
ALTER TRIGGER PROCESOS_CX_TRG ENABLE;

-- Verifica que esxista
SELECT trigger_name, status
FROM user_triggers
WHERE trigger_name = 'PROCESOS_CX_TRG';

-- Nuevo trigger
CREATE OR REPLACE TRIGGER trg_procesos_cx_fechas
BEFORE INSERT ON PROCESOS_CX
FOR EACH ROW
BEGIN
  -- Si no viene fecha de creación, se asigna la actual
  IF :NEW.FECHACREADO IS NULL THEN
    :NEW.FECHACREADO := SYSTIMESTAMP;
  END IF;

  -- También llenamos FECHAMODIFICA con la misma fecha al crear
  IF :NEW.FECHAMODIFICA IS NULL THEN
    :NEW.FECHAMODIFICA := SYSTIMESTAMP;
  END IF;
END;
/

